If the owner of the rare piece is a slow/unreliable/unknown uploader:

* Use small pipe. Is this handled at a higher level? The information
  is available there.

* Don't delegate a piece with a fast uploader?


Timeout of pieces and choking:

* Some clients do choke/unchoke cycles, put a timer for the true
  canceling of requested pieces.

* Different timeout for request that are currently being downloaded
  and those that haven't started.

* Starting timeout of some... 20 seconds?...


Snubbing:

* Individual rate control of uploads depending on downloads will
  handle clients that are snubing us.

* Differenciate between snubbers that have choked us and previous good
  uploaders or unknowns.


Delegator refactoring:


Few chunks mode:

* Select pieces with a higher number of seen's.

* Higher level needs to control the pipe size, use smaller 2-3?. This
  is not such a performance bottleneck since we usually don't get that
  high download speeds for the first ones.

* Always select the pieces with least number of pieces left. Unless
  we're already working on a piece.

* Quick timeouts.


Normal mode:

* Affinity to the chunk we're working on.

* Slow uploaders should prefer to work on the same chunks as other
  slow uploaders. Work on abundant pieces.

* Fast uploaders should have a large pipe and work on rare pieces.


Endgame mode:

* Divide the pieces download evenly.



****

Will we only need to delegate overlapping pieces in endgame mode?

* Requires that there's only one outstanding request per peer at any
  time in the endgame mode.

* No id needed in the delegation. No ref counting either, or use ref
  counting with only 0/1 in the normal mode and ref in endgame.

Do we have a timed out state and a truly canceled state?

* Timed out state can allow downloads that finaly start to be received.

* We could not prefer allocating timed out pieces. (except for endgame/startgame mode).

* Timed out state should eventually really time out. *snub*

* If the download finally starts we set the state to downloading.

* Pieces being downloaded have lower timeout than pieces waiting to start.

How to encode timed out and downloading as cheaply as possible? We need multiple ref's for endgame mode.

* One ref count for downloading, one for timed out.



How long will we acceptably wait for a chunk request to timeout?

What is required: progressive queueing based on download speed.



****

